<div class="payment-callback-container">
  <div class="callback-card">
    <!-- Loading State -->
    <div *ngIf="loading" class="text-center">
      <div class="spinner-border text-primary mb-3" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
      <h3>{{ verificationMessage }}</h3>
      <p class="text-muted">Please wait while we confirm your payment...</p>
    </div>

    <!-- Success State -->
    <div *ngIf="!loading && success" class="text-center">
      <div class="success-icon mb-3">
        <svg xmlns="http://www.w3.org/2000/svg" width="80" height="80" fill="currentColor" class="bi bi-check-circle-fill text-success" viewBox="0 0 16 16">
          <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z"/>
        </svg>
      </div>

      <h2 class="text-success mb-3">Payment Successful!</h2>
      <p class="text-muted mb-4">Your payment has been verified and processed successfully.</p>

      <div class="payment-details-card mb-4" *ngIf="paymentDetails">
        <div class="detail-row">
          <span class="detail-label">Payment ID:</span>
          <span class="detail-value">{{ paymentDetails.payment_id }}</span>
        </div>
        <div class="detail-row">
          <span class="detail-label">Amount:</span>
          <span class="detail-value">{{ formatCurrency(paymentDetails.amount) }}</span>
        </div>
        <div class="detail-row" *ngIf="paymentDetails.subscription_id">
          <span class="detail-label">Subscription ID:</span>
          <span class="detail-value">{{ paymentDetails.subscription_id }}</span>
        </div>
        <div class="detail-row" *ngIf="paymentDetails.transaction_id">
          <span class="detail-label">Transaction ID:</span>
          <span class="detail-value">{{ paymentDetails.transaction_id }}</span>
        </div>
      </div>

      <div class="alert alert-info mb-4">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-info-circle me-2" viewBox="0 0 16 16">
          <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
          <path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533L8.93 6.588zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0z"/>
        </svg>
        A payment receipt and invoice have been sent to your email address.
      </div>

      <div class="countdown-message mb-4">
        <p>Redirecting to dashboard in <strong>{{ countdown }}</strong> seconds...</p>
      </div>

      <div class="action-buttons">
        <button class="btn btn-primary btn-lg me-2" (click)="redirectToDashboard()">
          Go to Dashboard Now
        </button>
        <button class="btn btn-outline-primary btn-lg me-2" (click)="goToInvoices()">
          View Invoices
        </button>
        <button class="btn btn-outline-secondary btn-lg" (click)="goToPaymentHistory()">
          Payment History
        </button>
      </div>
    </div>

    <!-- Error State -->
    <div *ngIf="!loading && !success" class="text-center">
      <div class="error-icon mb-3">
        <svg xmlns="http://www.w3.org/2000/svg" width="80" height="80" fill="currentColor" class="bi bi-x-circle-fill text-danger" viewBox="0 0 16 16">
          <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM5.354 4.646a.5.5 0 1 0-.708.708L7.293 8l-2.647 2.646a.5.5 0 0 0 .708.708L8 8.707l2.646 2.647a.5.5 0 0 0 .708-.708L8.707 8l2.647-2.646a.5.5 0 0 0-.708-.708L8 7.293 5.354 4.646z"/>
        </svg>
      </div>

      <h2 class="text-danger mb-3">Payment Verification Failed</h2>
      <p class="text-muted mb-4">{{ error }}</p>

      <div class="alert alert-warning mb-4">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-exclamation-triangle me-2" viewBox="0 0 16 16">
          <path d="M7.938 2.016A.13.13 0 0 1 8.002 2a.13.13 0 0 1 .063.016.146.146 0 0 1 .054.057l6.857 11.667c.036.06.035.124.002.183a.163.163 0 0 1-.054.06.116.116 0 0 1-.066.017H1.146a.115.115 0 0 1-.066-.017.163.163 0 0 1-.054-.06.176.176 0 0 1 .002-.183L7.884 2.073a.147.147 0 0 1 .054-.057zm1.044-.45a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566z"/>
          <path d="M7.002 12a1 1 0 1 1 2 0 1 1 0 0 1-2 0zM7.1 5.995a.905.905 0 1 1 1.8 0l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995z"/>
        </svg>
        If you were charged but see this error, please contact support with reference: <strong>{{ paymentReference }}</strong>
      </div>

      <div class="action-buttons">
        <button class="btn btn-primary btn-lg me-2" (click)="retryVerification()">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-arrow-clockwise me-1" viewBox="0 0 16 16">
            <path fill-rule="evenodd" d="M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2v1z"/>
            <path d="M8 4.466V.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384L8.41 4.658A.25.25 0 0 1 8 4.466z"/>
          </svg>
          Retry Verification
        </button>
        <button class="btn btn-outline-secondary btn-lg" (click)="redirectToDashboard()">
          Go to Dashboard
        </button>
      </div>
    </div>
  </div>
</div>
